# --- 第一阶段：需求分析 ---
Expert1_Analysis_Task:
  description: >
    First, retrieve and carefully review the two rule tables ("Business-UI" and "Verb-UI") from the Knowledge Base to master the precise mapping relationships between business actions and frontend components. Taking this as the theoretical basis, conduct an in-depth analysis of the Product Requirements Document (PRD), sort out the overall business processes, and complete system classification (such as application-type, backend management-type, etc.) based on system functional attributes. Subsequently, strictly apply the mapping logic in the two aforementioned tables to accurately and separately extract the requirements that need to be implemented through frontend development for each step of the business processes. Finally, conduct a self-assessment on the completeness and accuracy of the extracted frontend requirements. If deviations are identified, an iterative optimization process must be initiated (with a maximum of 3 repetitions) until the requirements are clear, accurate, and error-free.
  expected_output: >
    Structured Frontend Requirements List
  agent:
    Requirements_Analyst

# --- 第二阶段：交互设计 (含 Expert1 评审) ---
Expert2_Design_Draft_Task:
  description: >
    Analyze the frontend requirements list from the Requirements Analyst and the Product Requirements Document (PRD), design user flow diagrams, design wireframes, and define interaction rules, with a focus on ensuring usability and operability.
  expected_output: >
    First Draft of Interaction Design Deliverables (User Flow Diagrams, Wireframes)
  agent:
    UX_Designer
  context:
    [Expert1_Analysis_Task]

Expert1_Review_Expert2_Task:
  description: >
    Verify whether the interaction design deliverables delivered by the UX Designer Agent comply with the frontend requirements list. If any issues are identified, list specific revision suggestions.
  expected_output: >
    A review report on the interaction design deliverables, including approval status and revision suggestions.
  agent:
    Requirements_Analyst
  context:
    [Expert1_Analysis_Task, Expert2_Design_Draft_Task]

Expert2_Design_Finalize_Task:
  description: >
    Based on the review report from the Requirements Analyst Agent, revise and optimize the interaction design solution, and output the final version of the deliverables.
  expected_output: >
    Final Version of Interaction Design Deliverables (User Flow Diagrams, Wireframes)
  agent:
    UX_Designer
  context:
    [Expert2_Design_Draft_Task, Expert1_Review_Expert2_Task]

# --- 第三阶段：UI设计 (含 Expert2 评审) ---
Expert3_UI_Draft_Task:
  description: >
    Analyze the interaction design deliverables from the UX Agent to clarify visual design boundaries; define visual specifications (colors, fonts, icons, layouts), and generate polished UI diagrams.
  expected_output: >
    Polished UI diagram files + Structured access credentials (Draft)
  agent:
    UILayout_Designer
  context:
    [Expert2_Design_Finalize_Task]

Expert2_Review_Expert3_Task:
  description: >
    As the reviewer, check if the visual design output from the UI Agent aligns with interaction flows and user experience principles.
  expected_output: >
    Review report on the visual design output from the UI Agent
  agent:
    UX_Designer
  context:
    [Expert2_Design_Finalize_Task, Expert3_UI_Draft_Task]

Expert3_UI_Finalize_Task:
  description: >
    Based on the review report from the UX Agent, adjust visual design details and output the final UI diagrams.
  expected_output: >
    Final polished UI diagram files + Structured access credentials
  agent:
    UILayout_Designer
  context:
    [Expert3_UI_Draft_Task, Expert2_Review_Expert3_Task]

# --- 第四阶段：代码生成 (含 Expert3 评审) ---
Expert4_Code_Draft_Task:
  description: >
    First, use the FileReadTool to retrieve and carefully review the component definitions in the "frontend_components.json" file from the Knowledge Base to master the specific code structures and property specifications of the reusable components. Analyze the UI Agent's design and Requirements List.
    CRITICAL EXECUTION RULES (MUST FOLLOW):
    1. Single Root Directory:** You MUST save ALL files into the directory: `./output_project/`.
       - Do NOT create `code_folder` or `project_v1` or random folders.
       - Start every file path with `./output_project/`.
    2. Standard Structure:** Use a professional React/Vue project structure:
       - `./output_project/package.json`
       - `./output_project/README.md`
       - `./output_project/src/App.js` (or .jsx/.vue)
       - `./output_project/src/index.js`
       - `./output_project/src/components/Header.js`
       - `./output_project/src/styles/main.css`
    3. Tool Argument Format:
       - When using the file saver tool, the argument list MUST use the key `path` (NOT `file_path`).
       - Correct Example: `files=[{"path": "./output_project/src/App.js", "content": "..."}]`
       - INCORRECT Example:** `files=[{"file_path": "...", ...}]` (This will crash).
    4. No Zip Files:** Do not compress files. Save them strictly as raw code files.
    Strictly apply the code patterns from "frontend_components.json" to generate production-grade UI code.
  expected_output: >
    A confirmation string listing all the files that have been successfully saved into the `./output_project/` directory. NO ZIP FILES.
  agent:
    Frontend_Developer
  context: [Expert1_Analysis_Task, Expert2_Design_Finalize_Task, Expert3_UI_Finalize_Task]

Expert3_Review_Expert4_Task:
  description: >
    As the reviewer, check if the UI code saved in the `./output_project/` directory faithfully reproduces the visual design details.
    Check if the file structure (`src/components`, `src/styles`) is reasonable and if the code matches the UI design.
  expected_output: >
    Visual fidelity review report on the UI code output from the Frontend Engineer Agent
  agent:
    UILayout_Designer
  context:
    [Expert3_UI_Finalize_Task, Expert4_Code_Draft_Task]

Expert4_Code_Finalize_Task:
  description: >
    Based on the review report, modify or add files directly in the `./output_project/` directory.
   REMINDERS:
     - Always use the `path` argument key for the tool.
     - Do NOT change the root folder. Keep everything in `./output_project/`.
     - Ensure `package.json` is present and valid.
  expected_output: >
    Final confirmation that all valid source code files exist in `./output_project/`.
  agent:
    Frontend_Developer
  context:
    [Expert4_Code_Draft_Task, Expert3_Review_Expert4_Task]

# --- 第五阶段：测试 ---
Expert5_Test_Task:
  description: >
    Retrieve final code, UI diagrams, and PRD to define the testing scope; execute visual regression testing: compare deviations between code and UI diagrams; conduct component interaction testing and routing testing; compile test data.
  expected_output: >
    Complete UI test result report
  agent:
    UITest_Engineer
  context:
    [Expert1_Analysis_Task, Expert3_UI_Finalize_Task, Expert4_Code_Finalize_Task]

# 最终交付
Final_Handover_Task:
  description: >
    [Final Delivery and Archiving]:
    1. Consolidate all final code validated by testing (HTML, CSS, JS, image placeholders, etc.).
    2. Key Step: You must call the "Project Saver Tool" to save these files.
    3. When calling the tool, please construct a clear file structure, for example:
       - index.html
       - css/style.css
       - js/app.js
       - components/Navbar.js
    4. Ensure the tool call is successful and return the tool's execution result (i.e., the save path).
  expected_output: >
    Tool call confirmation message displaying "Project saved successfully...", along with the generated ZIP file path.
  agent:
    Frontend_Developer # Ensure this uses Expert4's role name
  context:
    [Expert4_Code_Finalize_Task, Expert5_Test_Task]